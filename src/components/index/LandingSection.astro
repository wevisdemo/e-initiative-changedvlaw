---
import Config from '../../../e-initiative.config.mjs';
import SectionContainer from '../SectionContainer.astro';
import UpdateTimestamp from '../UpdateTimestamp.svelte';
import PenIcon from '../icons/PenIcon.svelte';
import LocationIcon from '../icons/LocationIcon.svelte';
import TableIcon from '../icons/TableIcon.svelte';
import { dayElapsed, isCampaignEnded } from '../../utils/campaign';
import { countSubmittedDocuments } from '../../utils/firebase';
import { countOfflineSignatures } from '../../utils/sheets';
import Sharer from '../Sharer.svelte';

const documentCount = await countSubmittedDocuments();
---

<SectionContainer
	outerClass="min-h-screen justify-center text-neutral"
	innerClass="flex flex-col gap-16 text-center md:flex-row"
	hideNavbar
>
	<div class="flex w-full flex-col items-center justify-center">
		<h1 class="heading-responsive-03 font-looped">Change DV Law</h1>
		<p class="text-nowrap">
			ลงชื่อเสนอร่าง พ.ร.บ.<br /> คุ้มครองผู้ถูกกระทำด้วยความรุนแรงในครอบครัวฉบับใหม่<br
			/>
			(ภาคประชาชน)
		</p>
		<img
			class="mt-4 w-[180px] max-w-[280px] md:w-[280px]"
			src="/content_01.svg"
			alt=""
		/>
	</div>
	<div class="my-auto flex w-full max-w-md flex-col space-y-2">
		<p class="body_03 mt-1">
			ต้องการ {Config.petition.expectedSignatures.toLocaleString()} รายชื่อ
		</p>

		<div class="flex flex-col gap-2">
			<div>
				<p class="heading-responsive-02">
					ลงแล้ว {documentCount.toLocaleString()} คน
				</p>
				<p>
					{dayElapsed > 0 && <>ภายใน </>}
					{
						Config.petition.endDate.toLocaleDateString('TH-th', {
							dateStyle: 'medium',
						})
					}
				</p>
			</div>
			<UpdateTimestamp client:load date={new Date()} />
			{
				isCampaignEnded ? (
					<div class="flex flex-row items-center gap-2">
						<div class="h-[2px] flex-1 bg-secondary" />
						<p class="font-bold text-secondary">ปิดรับลงชื่อแล้ว</p>
						<div class="h-[2px] flex-1 bg-secondary" />
					</div>
				) : (
					<div class="space-y-2">
						<a
							href="#sign"
							class="heading-03 btn btn-secondary btn-block text-base-300"
						>
							ลงชื่อเลย
							<PenIcon />
						</a>
					</div>
				)
			}
		</div>

		<a
			class="heading-03 btn btn-link btn-block text-base-100 hover:text-accent"
			href="#why-sign">ทำไมต้องลงชื่อ</a
		>

		<div class="flex items-center justify-center gap-3 text-base-100">
			<span class="body-01">แชร์</span>
			<Sharer />
		</div>
	</div>
</SectionContainer>
